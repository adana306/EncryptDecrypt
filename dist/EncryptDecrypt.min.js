/**
 * 
 * @source: https://github.com/wwwouaiebe/EncryptDecrypt
 * 
 * @licstart  The following is the entire license notice for the
 * JavaScript code in this page.
 * 
 * encryptdecript - version 2.0.0-dev
 * Build  - 2023-03-02T18:06:38+0100 
 * Copyright 2019 2023 wwwouaiebe 
 * Contact: https://www.ouaie.be/
 * License: GPL-3.0
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @licend  The above is the entire license notice
 * for the JavaScript code in this page.
 * 
 */


!function(){"use strict";const e=new class{#e;#t(e){return window.crypto.subtle.importKey("raw",e,{name:"PBKDF2"},!1,["deriveKey"])}#n(e,t){return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:(new window.TextEncoder).encode(t),iterations:1e6,hash:"SHA-256"},e,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}#i(e,t){return window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(t.slice(0,16))},e,new Uint8Array(t.slice(16)))}#r(e,t,n){return window.crypto.subtle.encrypt({name:"AES-GCM",iv:t},e,n)}constructor(e){this.#e=e||"Tire la chevillette la bobinette cherra. Le Petit Chaperon rouge tira la chevillette.",Object.freeze(this)}encryptData(e,t,n,i){let r=window.crypto.getRandomValues(new Uint8Array(16));i.then((e=>this.#t(e))).then((e=>this.#n(e,this.#e))).then((t=>this.#r(t,r,e))).then((e=>{t(new Blob([r,new Uint8Array(e)],{type:"application/octet-stream"}))})).catch(n)}decryptData(e,t,n,i){i.then((e=>this.#t(e))).then((e=>this.#n(e,this.#e))).then((t=>this.#i(t,e))).then(t).catch(n)}};const t=new class{#s;#o;constructor(){Object.freeze(this),this.#o=document.createElement("div"),this.#o.id="waitAnimation";const e=document.createElement("div");e.id="waitAnimationBullet",this.#o.appendChild(e),this.#s=!0}show(){this.#s&&(document.body.appendChild(this.#o),this.#s=!1)}hide(){this.#s||(document.body.removeChild(this.#o),this.#s=!0)}};class n{#o;#c;#l;#a;#h;#d;#m;#p;static get#u(){return 12}#E(e){"pswInput"===e.target.id&&("Escape"===e.key||"Esc"===e.key?this.#y():"Enter"===e.key&&this.#w())}#L(){document.body.removeChild(this.#o)}#T(e,t,n){this.#m=t,this.#p=n,this.#d.innerText="Decrypt"===e?"Type the password used for encryption":"The password must be at least 12 characters long and contain at least \t\t\tone capital, one lowercase, one number, and one other character.",this.#d.classList.remove("red"),document.body.appendChild(this.#o),this.#a.value="",this.#a.focus()}#y(){this.#L(),this.#p(new Error("Canceled by user")),this.#a.value=""}#w(){let e=this.#a.value;if(n.#u>e.length||!e.match(RegExp("[0-9]+"))||!e.match(RegExp("[a-z]+"))||!e.match(RegExp("[A-Z]+"))||!e.match(RegExp("[^0-9a-zA-Z]")))return this.#a.focus(),this.#d.innerText="The password must be at least 12 characters long and contain at least \t\t\t\tone capital, one lowercase, one number, and one other character.",void this.#d.classList.add("red");this.#L(),t.show(),this.#m((new window.TextEncoder).encode(e)),this.#a.value=""}#H(){this.#h.innerText="👀",this.#a.type="text"}#M(){this.#h.innerText="👁️",this.#a.type="password"}constructor(){Object.freeze(this),this.#o=document.createElement("div"),this.#o.id="pswMainDiv";const e=document.createElement("div");e.id="pswDiv",this.#o.appendChild(e);const t=document.createElement("label");t.htmlFor="pswInput",t.appendChild(document.createTextNode("Password : ")),e.appendChild(t),this.#a=document.createElement("input"),this.#a.type="password",this.#a.id="pswInput",e.appendChild(this.#a),this.#h=document.createElement("span"),this.#h.innerText="👁️",this.#h.id="pswEye",e.appendChild(this.#h),this.#h.addEventListener("mousedown",(()=>this.#H())),this.#h.addEventListener("mouseup",(()=>this.#M())),this.#h.addEventListener("mouseleave",(()=>this.#M()));const n=document.createElement("div");n.id="buttonsDiv",this.#o.appendChild(n),this.#c=document.createElement("input"),this.#c.type="button",this.#c.value="Ok",this.#c.id="okButton",this.#c.addEventListener("click",(()=>this.#w())),n.appendChild(this.#c),this.#l=document.createElement("input"),this.#l.type="button",this.#l.value="Cancel",this.#l.id="cancelButton",this.#l.addEventListener("click",(()=>this.#y())),n.appendChild(this.#l),this.#d=document.createElement("div"),this.#d.id="errorPswDiv",this.#o.appendChild(this.#d),document.addEventListener("keydown",(e=>this.#E(e)),!0)}getShowPromise(e){return new Promise(((t,n)=>this.#T(e,t,n)))}}const i=new n;const r=new class{#s;#o;constructor(){Object.freeze(this),this.#o=document.createElement("div"),this.#o.id="errorInterface",this.#s=!0}set errorMsg(e){this.#o.innerText=e,this.#o.classList.add("red")}set infoMsg(e){this.#o.innerText=e,this.#o.classList.remove("red")}show(){this.#s&&(this.#o.innerText="",document.body.appendChild(this.#o),this.#s=!1)}hide(){this.#s||(document.body.removeChild(this.#o),this.#s=!0)}};class s{#v;static get#g(){return 200}#C(e){t.hide(),this.#v.show();let n=null;try{n=JSON.parse((new TextDecoder).decode(e))}catch(e){return void this.#b(e)}let i=[];for(let e in n.data)i.push(n.data[e]);let r=new Blob([new Uint8Array(i)],{type:n.type}),s=URL.createObjectURL(r),o=document.createElement("a");o.setAttribute("href",s),-1===["application/pdf","text/html","image/jpeg","image/png"].indexOf(n.type)&&o.setAttribute("download",n.name),o.click(),window.URL.revokeObjectURL(s)}#D(e){t.hide(),this.#v.show();let n=URL.createObjectURL(e),i=document.createElement("a");i.setAttribute("href",n),i.setAttribute("download","Data"),i.click(),window.URL.revokeObjectURL(n)}#b(e){t.hide(),this.#v.show(),r.show(),r.errorMsg=e.message}constructor(e){Object.freeze(this),this.#v=e}decryptURL(t){fetch(t).then((e=>e.ok&&s.#g===e.status?e.arrayBuffer():Promise.reject(new Error("Invalid url for the encoded file")))).then((t=>{r.hide(),e.decryptData(t,(e=>this.#C(e)),(e=>this.#b(e)),i.getShowPromise("Decrypt"))})).catch((e=>this.#b(e)))}encryptFile(t){let n=new FileReader;n.onload=()=>{r.hide(),e.encryptData((new window.TextEncoder).encode(JSON.stringify({data:new Uint8Array(n.result),name:t.name,type:t.type})),(e=>this.#D(e)),(e=>this.#b(e)),i.getShowPromise("Encrypt"))},n.readAsArrayBuffer(t)}decryptFile(t){let n=new FileReader;n.onload=()=>{r.hide(),e.decryptData(n.result,(e=>this.#C(e)),(e=>this.#b(e)),i.getShowPromise("Decrypt"))},n.readAsArrayBuffer(t)}}const o=new class{#s;#f;#o;#k;#E(e){"urlDecrypt"===e.target.id&&"Enter"===e.key&&this.#B()}#I(e){this.hide(),this.#f.encryptFile(e.target.files[0])}#O(e){this.hide(),this.#f.decryptFile(e.target.files[0])}#B(){this.hide(),this.#f.decryptURL(this.#k.value)}#U(){const e=document.createElement("h3");e.innerText="Encrypt",this.#o.appendChild(e);const t=document.createElement("div");this.#o.appendChild(t);const n=document.createElement("input");n.type="file",n.id="encryptButton",n.addEventListener("change",(e=>this.#I(e))),t.appendChild(n)}#A(){const e=document.createElement("h3");e.innerText="Decrypt",this.#o.appendChild(e);const t=document.createElement("div");this.#o.appendChild(t);const n=document.createElement("input");n.type="file",n.id="decryptButton",n.addEventListener("change",(e=>this.#O(e))),t.appendChild(n),this.#k=document.createElement("input"),this.#k.type="url",this.#k.id="urlDecrypt",this.#k.size="40",this.#k.placeholder="https://",t.appendChild(this.#k);let i=document.createElement("input");i.type="button",i.value="Go",i.id="goButton",i.addEventListener("click",(()=>this.#B())),t.appendChild(i)}constructor(){Object.freeze(this),this.#o=document.createElement("div"),this.#o.id="encryptDecrypt",this.#U(),this.#A(),this.#s=!0,this.#f=new s(this),document.addEventListener("keydown",(e=>this.#E(e)),!0)}show(){this.#s&&(window.document.body.appendChild(this.#o),this.#s=!1)}hide(){this.#s||(document.body.removeChild(this.#o),this.#s=!0)}};(new class{#P(){return window.isSecureContext?window.crypto&&window.crypto.subtle&&window.crypto.subtle.importKey?window.crypto.subtle.importKey("raw",(new window.TextEncoder).encode("hoho"),{name:"PBKDF2"},!1,["deriveKey"]):Promise.reject(new Error("Cryptographic functions are not installed")):Promise.reject(new Error("You don't use a secure context (https or localhost)"))}#x(){const e=new URL(window.location);let t=e.searchParams.get("fil");if(t&&0!==t.length){try{t=atob(t)}catch(e){return Promise.reject(new Error("The fil parameter is not a valid base64 string"))}if(t.match(/[^\w-%:./]/))return Promise.reject(new Error("invalid char in the url encoded in the fil parameter"));const n=new URL(t,e.protocol+"//"+e.hostname);return e.protocol&&n.protocol&&e.protocol===n.protocol&&e.hostname&&n.hostname&&e.hostname===n.hostname?Promise.resolve(encodeURI(n.href)):Promise.reject(new Error("The distant file is not on the same site than the app or use another protocol (http: <-> https:)"))}return Promise.resolve()}startApp(){this.#P().then((()=>this.#x())).then((e=>{e?s.decryptURL(e):o.show()})).catch((e=>{r.show(),r.errorMsg=e.message}))}constructor(){Object.freeze(this)}}).startApp()}();